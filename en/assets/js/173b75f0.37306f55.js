"use strict";(self.webpackChunklukso_docs=self.webpackChunklukso_docs||[]).push([[5553],{3905:(e,r,n)=>{n.d(r,{Zo:()=>c,kt:()=>u});var s=n(7294);function a(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function o(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,s)}return n}function t(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?o(Object(n),!0).forEach((function(r){a(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function i(e,r){if(null==e)return{};var n,s,a=function(e,r){if(null==e)return{};var n,s,a={},o=Object.keys(e);for(s=0;s<o.length;s++)n=o[s],r.indexOf(n)>=0||(a[n]=e[n]);return a}(e,r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],r.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=s.createContext({}),d=function(e){var r=s.useContext(l),n=r;return e&&(n="function"==typeof e?e(r):t(t({},r),e)),n},c=function(e){var r=d(e.components);return s.createElement(l.Provider,{value:r},e.children)},p={inlineCode:"code",wrapper:function(e){var r=e.children;return s.createElement(s.Fragment,{},r)}},m=s.forwardRef((function(e,r){var n=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),m=d(n),u=a,f=m["".concat(l,".").concat(u)]||m[u]||p[u]||o;return n?s.createElement(f,t(t({ref:r},c),{},{components:n})):s.createElement(f,t({ref:r},c))}));function u(e,r){var n=arguments,a=r&&r.mdxType;if("string"==typeof e||a){var o=n.length,t=new Array(o);t[0]=m;var i={};for(var l in r)hasOwnProperty.call(r,l)&&(i[l]=r[l]);i.originalType=e,i.mdxType="string"==typeof e?e:a,t[1]=i;for(var d=2;d<o;d++)t[d]=n[d];return s.createElement.apply(null,t)}return s.createElement.apply(null,n)}m.displayName="MDXCreateElement"},3416:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>t,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>d});var s=n(7462),a=(n(7294),n(3905));const o={sidebar_label:"Obtener direcciones del controlador",sidebar_position:2},t="Obtener direcciones del controlador",i={unversionedId:"es/guides/key-manager/get-controllers",id:"es/guides/key-manager/get-controllers",title:"Obtener direcciones del controlador",description:"En esta gu\xeda aprender\xe1s a:",source:"@site/docs/es/guides/key-manager/get-controllers.md",sourceDirName:"es/guides/key-manager",slug:"/es/guides/key-manager/get-controllers",permalink:"/lukso-es/en/es/guides/key-manager/get-controllers",draft:!1,editUrl:"https://github.com/lukso-network/docs/tree/main/docs/es/guides/key-manager/get-controllers.md",tags:[],version:"current",lastUpdatedAt:1680495619,formattedLastUpdatedAt:"Apr 3, 2023",sidebarPosition:2,frontMatter:{sidebar_label:"Obtener direcciones del controlador",sidebar_position:2},sidebar:"guidesSidebar",previous:{title:"Otorgar permisos a terceros",permalink:"/lukso-es/en/es/guides/key-manager/give-permissions"},next:{title:"Ejecutar Transacciones por Retransmisi\xf3n",permalink:"/lukso-es/en/es/guides/key-manager/execute-relay-transactions"}},l={},d=[{value:"Configuraci\xf3n",id:"configuraci\xf3n",level:2},{value:"Paso 1 - Configurar web3.js y erc725.js",id:"paso-1---configurar-web3js-y-erc725js",level:2},{value:"Paso 2 - Obtener la lista de direcciones del controlador",id:"paso-2---obtener-la-lista-de-direcciones-del-controlador",level:2},{value:"Paso 3 - Obtener los permisos de cada controlador",id:"paso-3---obtener-los-permisos-de-cada-controlador",level:2},{value:"3.1 - Recuperar los permisos del controlador",id:"31---recuperar-los-permisos-del-controlador",level:3},{value:"3.2 - Descifrar los permisos del controlador",id:"32---descifrar-los-permisos-del-controlador",level:3},{value:"C\xf3digo Final",id:"c\xf3digo-final",level:2}],c={toc:d};function p(e){let{components:r,...o}=e;return(0,a.kt)("wrapper",(0,s.Z)({},c,o,{components:r,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"obtener-direcciones-del-controlador"},"Obtener direcciones del controlador"),(0,a.kt)("p",null,"En esta gu\xeda aprender\xe1s a:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"recuperar todas las direcciones que tienen alg\xfan permiso establecido en un Perfil Universal,"),(0,a.kt)("li",{parentName:"ul"},"recuperar el permiso de cada una de estas ",(0,a.kt)("strong",{parentName:"li"},"direcciones de controlador"),".")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Obtener direcciones del controlador",src:n(3282).Z,width:"1365",height:"732"})),(0,a.kt)("p",null,"Utilizaremos la librer\xeda ",(0,a.kt)("a",{parentName:"p",href:"/lukso-es/en/es/tools/erc725js/getting-started"},(0,a.kt)("em",{parentName:"a"},"erc725.js"))," para hacerlo con poco m\xe1s de 30 l\xedneas de c\xf3digo."),(0,a.kt)("h2",{id:"configuraci\xf3n"},"Configuraci\xf3n"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"npm install @erc725/erc725.js\n")),(0,a.kt)("h2",{id:"paso-1---configurar-web3js-y-erc725js"},"Paso 1 - Configurar web3.js y erc725.js"),(0,a.kt)("p",null,"El primer paso es configurar tanto ",(0,a.kt)("em",{parentName:"p"},"web3.js")," como ",(0,a.kt)("em",{parentName:"p"},"erc725.js"),", y conectarnos a la red L16 de LUKSO. Tambi\xe9n necesitaremos la direcci\xf3n del Perfil Universal del cual queremos obtener las direcciones de los controladores."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"import { ERC725 } from '@erc725/erc725.js';\nimport LSP6Schema from '@erc725/erc725.js/schemas/LSP6KeyManager.json';\nimport Web3 from 'web3';\n\n// ajustes\nconst myUniversalProfileAddress = '0xC26508178c4D7d3Ad43Dcb9F9bb1fab9ceeD58B5';\nconst RPC_ENDPOINT = 'https://rpc.l16.lukso.network';\n\n// paso 1 - configura erc725.js\nconst web3 = new Web3(RPC_ENDPOINT);\nconst erc725 = new ERC725(\n  LSP6Schema,\n  myUniversalProfileAddress,\n  web3.currentProvider,\n);\n")),(0,a.kt)("h2",{id:"paso-2---obtener-la-lista-de-direcciones-del-controlador"},"Paso 2 - Obtener la lista de direcciones del controlador"),(0,a.kt)("p",null,"El siguiente paso es obtener la lista de direcciones de los controladores. En otras palabras, las direcciones con algunos permisos para interactuar con el Perfil Universal."),(0,a.kt)("p",null,"Todas las direcciones de los controladores aparecen en la clave de datos ",(0,a.kt)("inlineCode",{parentName:"p"},"AddressPermissions[]"),". Podemos obtenerlas mediante:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"consultar el ",(0,a.kt)("inlineCode",{parentName:"li"},"AddressPermissions[]")," para obtener el tama\xf1o de la matriz y saber ",(0,a.kt)("strong",{parentName:"li"},"cu\xe1ntas direcciones de controlador")," cuentan con permisos en el UP."),(0,a.kt)("li",{parentName:"ol"},"consulta cada \xedndice de la matriz ",(0,a.kt)("inlineCode",{parentName:"li"},"AddressPermissions[index]")," para recuperar cada direcci\xf3n individualmente.")),(0,a.kt)("p",null,"Gracias a ",(0,a.kt)("em",{parentName:"p"},"erc725.js"),", podemos hacerlo muy f\xe1cilmente. La librer\xeda har\xe1 ambos pasos por nosotros y nos devolver\xe1 la lista completa de direcciones de controladores."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// paso 2 - obtener la lista de direcciones que tienen permisos en el Perfil Universal\nconst result = await erc725.getData('AddressPermissions[]');\nconsole.log(result);\n\n// {\n//   key: '0xdf30dba06db6a30e65354d9a64c609861f089545ca58c6b4dbe31a5f338cb0e3',\n//   name: 'AddressPermissions[]',\n//   value: [\n//     '0x5F606b5b237623463a90F63230F9b929321dbCBa',\n//     '0xa1061408e55c971fD129eF5561dFB953d598dAD7'\n//   ]\n// }\n")),(0,a.kt)("h2",{id:"paso-3---obtener-los-permisos-de-cada-controlador"},"Paso 3 - Obtener los permisos de cada controlador"),(0,a.kt)("p",null,"Obtener las direcciones de cada controlador no es suficiente. Necesitamos recuperar los permisos de cada una de estas direcciones de controlador, para saber lo que tienen permitido hacer en nuestro Perfil Universal."),(0,a.kt)("p",null,"Podemos hacerlo f\xe1cilmente con las funciones ",(0,a.kt)("a",{parentName:"p",href:"../../tools/erc725js/classes/ERC725#getdata"},(0,a.kt)("inlineCode",{parentName:"a"},"getData(...)"))," y ",(0,a.kt)("a",{parentName:"p",href:"../../tools/erc725js/classes/ERC725#decodepermissions"},(0,a.kt)("inlineCode",{parentName:"a"},"decodePermissions(...)"))," de ",(0,a.kt)("em",{parentName:"p"},"erc725.js"),"."),(0,a.kt)("h3",{id:"31---recuperar-los-permisos-del-controlador"},"3.1 - Recuperar los permisos del controlador"),(0,a.kt)("p",null,"Utilizando ",(0,a.kt)("inlineCode",{parentName:"p"},"getData(...)")," con la clave de datos ",(0,a.kt)("inlineCode",{parentName:"p"},"AddressPermissions:Permissions:<address>"),", podemos pasar la direcci\xf3n del controlador como la parte din\xe1mica ",(0,a.kt)("inlineCode",{parentName:"p"},"<address>")," en la clave de datos."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// paso 3.1 - obtener los permisos de cada direcci\xf3n\nconst addressPermission = await erc725.getData({\n  keyName: 'AddressPermissions:Permissions:<address>',\n  dynamicKeyParts: address,\n});\nconsole.log(addressPermission);\n\n// {\n//   key: '0x4b80742de2bf82acb3630000a1061408e55c971fd129ef5561dfb953d598dad7',\n//   name: 'AddressPermissions:Permissions:a1061408e55c971fD129eF5561dFB953d598dAD7',\n//   value: '0x0000000000000000000000000000000000000000000000000000000000000008'\n// }\n")),(0,a.kt)("h3",{id:"32---descifrar-los-permisos-del-controlador"},"3.2 - Descifrar los permisos del controlador"),(0,a.kt)("p",null,"Como puedes ver en el paso 3.1, el permiso que obtenemos para una direcci\xf3n de controlador sigue cifrado en ",(0,a.kt)("inlineCode",{parentName:"p"},"bytes32")," como un ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/lukso-network/LIPs/blob/main/LSPs/LSP-2-ERC725YJSONSchema.md#BitArray"},(0,a.kt)("inlineCode",{parentName:"a"},"BitArray")),"."),(0,a.kt)("p",null,"Para leer los permisos del controlador en un formato humanamente comprensible, podemos utilizar la funci\xf3n ",(0,a.kt)("a",{parentName:"p",href:"../../tools/erc725js/classes/ERC725#decodepermissions"},(0,a.kt)("inlineCode",{parentName:"a"},"decodePermissions(...)"))," de ",(0,a.kt)("em",{parentName:"p"},"erc725.js"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'// paso 3.2 - decodifica la autorizaci\xf3n de cada direcci\xf3n\nconst decodedPermission = erc725.decodePermissions(addressPermission.value);\n\n// utilizamos JSON.stringify para mostrar el permiso en un formato legible\nconsole.log(\n  `decoded permission for ${address} = ` +\n    JSON.stringify(decodedPermission, null, 2),\n);\n\n// decoded permission for 0x5F606b5b237623463a90F63230F9b929321dbCBa = {\n//   "CHANGEOWNER": true,\n//   "CHANGEPERMISSIONS": true,\n//   "ADDPERMISSIONS": true,\n//   "SETDATA": true,\n//   "CALL": true,\n//   "STATICCALL": true,\n//   "DELEGATECALL": false,\n//   "DEPLOY": true,\n//   "TRANSFERVALUE": true,\n//   "SIGN": true,\n//   "SUPER_SETDATA": false,\n//   "SUPER_TRANSFERVALUE": true,\n//   "SUPER_CALL": true,\n//   "SUPER_STATICCALL": true,\n//   "SUPER_DELEGATECALL": false\n// }\n')),(0,a.kt)("h2",{id:"c\xf3digo-final"},"C\xf3digo Final"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"import { ERC725 } from '@erc725/erc725.js';\nimport LSP6Schema from '@erc725/erc725.js/schemas/LSP6KeyManager.json';\nimport Web3 from 'web3';\n\n// ajustes\nconst myUniversalProfileAddress = '0xC26508178c4D7d3Ad43Dcb9F9bb1fab9ceeD58B5';\nconst RPC_ENDPOINT = 'https://rpc.l16.lukso.network';\n\nconst web3 = new Web3(RPC_ENDPOINT);\n\n// paso 1 - configura erc725.js\nconst erc725 = new ERC725(\n  LSP6Schema,\n  myUniversalProfileAddress,\n  web3.currentProvider,\n);\n\nasync function getPermissionedAddresses() {\n  // paso 2 - consigue la lista de direcciones que tienen permisos en el Perfil Universal\n  const result = await erc725.getData('AddressPermissions[]');\n\n  for (let ii = 0; ii < result.value.length; ii++) {\n    const address = result.value[ii];\n\n    // paso 3.1 - obtener los permisos de cada direcci\xf3n\n    const addressPermission = await erc725.getData({\n      keyName: 'AddressPermissions:Permissions:<address>',\n      dynamicKeyParts: address,\n    });\n\n    // paso 3.2 - decodificar el permiso de cada direcci\xf3n\n    const decodedPermission = erc725.decodePermissions(addressPermission.value);\n\n    // utilizamos JSON.stringify para mostrar el permiso en un formato legible\n    console.log(\n      `decoded permission for ${address} = ` +\n        JSON.stringify(decodedPermission, null, 2),\n    );\n  }\n}\n\ngetPermissionedAddresses();\n")))}p.isMDXComponent=!0},3282:(e,r,n)=>{n.d(r,{Z:()=>s});const s=n.p+"assets/images/lsp6-address-permissions-array-eea61d91c1a7358918fd7c9562e1d034.jpeg"}}]);