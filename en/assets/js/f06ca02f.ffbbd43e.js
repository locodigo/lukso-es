"use strict";(self.webpackChunklukso_docs=self.webpackChunklukso_docs||[]).push([[8529],{3905:(e,n,a)=>{a.d(n,{Zo:()=>c,kt:()=>m});var t=a(7294);function r(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function s(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,t)}return a}function i(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?s(Object(a),!0).forEach((function(n){r(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function o(e,n){if(null==e)return{};var a,t,r=function(e,n){if(null==e)return{};var a,t,r={},s=Object.keys(e);for(t=0;t<s.length;t++)a=s[t],n.indexOf(a)>=0||(r[a]=e[a]);return r}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(t=0;t<s.length;t++)a=s[t],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=t.createContext({}),u=function(e){var n=t.useContext(l),a=n;return e&&(a="function"==typeof e?e(n):i(i({},n),e)),a},c=function(e){var n=u(e.components);return t.createElement(l.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},p=t.forwardRef((function(e,n){var a=e.components,r=e.mdxType,s=e.originalType,l=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),p=u(a),m=r,g=p["".concat(l,".").concat(m)]||p[m]||d[m]||s;return a?t.createElement(g,i(i({ref:n},c),{},{components:a})):t.createElement(g,i({ref:n},c))}));function m(e,n){var a=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var s=a.length,i=new Array(s);i[0]=p;var o={};for(var l in n)hasOwnProperty.call(n,l)&&(o[l]=n[l]);o.originalType=e,o.mdxType="string"==typeof e?e:r,i[1]=o;for(var u=2;u<s;u++)i[u]=a[u];return t.createElement.apply(null,i)}return t.createElement.apply(null,a)}p.displayName="MDXCreateElement"},5162:(e,n,a)=>{a.d(n,{Z:()=>i});var t=a(7294),r=a(6010);const s="tabItem_Ymn6";function i(e){let{children:n,hidden:a,className:i}=e;return t.createElement("div",{role:"tabpanel",className:(0,r.Z)(s,i),hidden:a},n)}},4866:(e,n,a)=>{a.d(n,{Z:()=>E});var t=a(7462),r=a(7294),s=a(6010),i=a(2466),o=a(6775),l=a(1980),u=a(7392),c=a(12);function d(e){return function(e){return r.Children.map(e,(e=>{if((0,r.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))}(e).map((e=>{let{props:{value:n,label:a,attributes:t,default:r}}=e;return{value:n,label:a,attributes:t,default:r}}))}function p(e){const{values:n,children:a}=e;return(0,r.useMemo)((()=>{const e=n??d(a);return function(e){const n=(0,u.l)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,a])}function m(e){let{value:n,tabValues:a}=e;return a.some((e=>e.value===n))}function g(e){let{queryString:n=!1,groupId:a}=e;const t=(0,o.k6)(),s=function(e){let{queryString:n=!1,groupId:a}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!a)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return a??null}({queryString:n,groupId:a});return[(0,l._X)(s),(0,r.useCallback)((e=>{if(!s)return;const n=new URLSearchParams(t.location.search);n.set(s,e),t.replace({...t.location,search:n.toString()})}),[s,t])]}function b(e){const{defaultValue:n,queryString:a=!1,groupId:t}=e,s=p(e),[i,o]=(0,r.useState)((()=>function(e){let{defaultValue:n,tabValues:a}=e;if(0===a.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!m({value:n,tabValues:a}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${a.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const t=a.find((e=>e.default))??a[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:s}))),[l,u]=g({queryString:a,groupId:t}),[d,b]=function(e){let{groupId:n}=e;const a=function(e){return e?`docusaurus.tab.${e}`:null}(n),[t,s]=(0,c.Nk)(a);return[t,(0,r.useCallback)((e=>{a&&s.set(e)}),[a,s])]}({groupId:t}),h=(()=>{const e=l??d;return m({value:e,tabValues:s})?e:null})();(0,r.useEffect)((()=>{h&&o(h)}),[h]);return{selectedValue:i,selectValue:(0,r.useCallback)((e=>{if(!m({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);o(e),u(e),b(e)}),[u,b,s]),tabValues:s}}var h=a(2389);const f="tabList__CuJ",v="tabItem_LNqP";function k(e){let{className:n,block:a,selectedValue:o,selectValue:l,tabValues:u}=e;const c=[],{blockElementScrollPositionUntilNextRender:d}=(0,i.o5)(),p=e=>{const n=e.currentTarget,a=c.indexOf(n),t=u[a].value;t!==o&&(d(n),l(t))},m=e=>{var n;let a=null;switch(e.key){case"Enter":p(e);break;case"ArrowRight":{const n=c.indexOf(e.currentTarget)+1;a=c[n]??c[0];break}case"ArrowLeft":{const n=c.indexOf(e.currentTarget)-1;a=c[n]??c[c.length-1];break}}null==(n=a)||n.focus()};return r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.Z)("tabs",{"tabs--block":a},n)},u.map((e=>{let{value:n,label:a,attributes:i}=e;return r.createElement("li",(0,t.Z)({role:"tab",tabIndex:o===n?0:-1,"aria-selected":o===n,key:n,ref:e=>c.push(e),onKeyDown:m,onClick:p},i,{className:(0,s.Z)("tabs__item",v,null==i?void 0:i.className,{"tabs__item--active":o===n})}),a??n)})))}function w(e){let{lazy:n,children:a,selectedValue:t}=e;if(n){const e=a.find((e=>e.props.value===t));return e?(0,r.cloneElement)(e,{className:"margin-top--md"}):null}return r.createElement("div",{className:"margin-top--md"},a.map(((e,n)=>(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==t}))))}function y(e){const n=b(e);return r.createElement("div",{className:(0,s.Z)("tabs-container",f)},r.createElement(k,(0,t.Z)({},e,n)),r.createElement(w,(0,t.Z)({},e,n)))}function E(e){const n=(0,h.Z)();return r.createElement(y,(0,t.Z)({key:String(n)},e))}},5473:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>m,frontMatter:()=>o,metadata:()=>u,toc:()=>d});var t=a(7462),r=(a(7294),a(3905)),s=a(4866),i=a(5162);const o={sidebar_label:"Iniciar sesi\xf3n con Ethereum",sidebar_position:4},l="Iniciar sesi\xf3n con Ethereum",u={unversionedId:"es/guides/browser-extension/sign-in-with-ethereum",id:"es/guides/browser-extension/sign-in-with-ethereum",title:"Iniciar sesi\xf3n con Ethereum",description:"La Extensi\xf3n de navegador LUKSO es compatible con EIP-4361: Inicio de sesi\xf3n con Ethereum.",source:"@site/docs/es/guides/browser-extension/sign-in-with-ethereum.md",sourceDirName:"es/guides/browser-extension",slug:"/es/guides/browser-extension/sign-in-with-ethereum",permalink:"/lukso-es/en/es/guides/browser-extension/sign-in-with-ethereum",draft:!1,editUrl:"https://github.com/lukso-network/docs/tree/main/docs/es/guides/browser-extension/sign-in-with-ethereum.md",tags:[],version:"current",lastUpdatedAt:1680495619,formattedLastUpdatedAt:"Apr 3, 2023",sidebarPosition:4,frontMatter:{sidebar_label:"Iniciar sesi\xf3n con Ethereum",sidebar_position:4},sidebar:"guidesSidebar",previous:{title:"Interactuar con una dApp",permalink:"/lukso-es/en/es/guides/browser-extension/interact-with-dapp"},next:{title:"Firmar mensajes arbitrarios",permalink:"/lukso-es/en/es/guides/browser-extension/sign-arbitrary-messages"}},c={},d=[{value:"1. Obtener la direcci\xf3n del perfil universal",id:"1-obtener-la-direcci\xf3n-del-perfil-universal",level:2},{value:"2. Preparar el mensaje",id:"2-preparar-el-mensaje",level:2},{value:"3. Firmar el mensaje",id:"3-firmar-el-mensaje",level:2},{value:"4. Validar la firma",id:"4-validar-la-firma",level:2}],p={toc:d};function m(e){let{components:n,...a}=e;return(0,r.kt)("wrapper",(0,t.Z)({},p,a,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"iniciar-sesi\xf3n-con-ethereum"},"Iniciar sesi\xf3n con Ethereum"),(0,r.kt)("p",null,"La ",(0,r.kt)("a",{parentName:"p",href:"/lukso-es/en/es/guides/browser-extension/install-browser-extension"},"Extensi\xf3n de navegador LUKSO")," es compatible con ",(0,r.kt)("a",{parentName:"p",href:"https://eips.ethereum.org/EIPS/eip-4361"},"EIP-4361: Inicio de sesi\xf3n con Ethereum"),".\nPor lo tanto, si el mensaje que desea firmar cumple esta norma, la Extensi\xf3n de navegador LUKSO mostrar\xe1 una pantalla de inicio de sesi\xf3n personalizada."),(0,r.kt)("div",{style:{textAlign:"center"}},(0,r.kt)("img",{src:"/img/extension/lukso-extension-siwe.webp",alt:"Ejemplo de pantalla de acceso con Ethereum"})),(0,r.kt)("h2",{id:"1-obtener-la-direcci\xf3n-del-perfil-universal"},"1. Obtener la direcci\xf3n del perfil universal"),(0,r.kt)("p",null,"La extensi\xf3n del navegador inyecta la direcci\xf3n del contrato del perfil universal en la p\xe1gina. Necesitamos esta direcci\xf3n para generar el mensaje a firmar."),(0,r.kt)(s.Z,{groupId:"provider",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"ethers",label:"Ethers.js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"import { ethers } from 'ethers';\n\nconst etherProvider = new ethers.providers.Web3Provider(window.ethereum);\n\nconst accountsRequest = await etherProvider.send('eth_requestAccounts', []);\nconst signer = etherProvider.getSigner();\nconst upAddress = await signer.getAddress();\n// 0x3E39275Ed3B370E074534edeE13a166512AD32aB\n"))),(0,r.kt)(i.Z,{value:"web3",label:"web3.js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"import Web3 from 'web3';\n\nconst web3 = new Web3(window.ethereum);\n\nconst accountsRequest = await web3.eth.requestAccounts();\nconst accounts = await web3.eth.getAccounts();\nconst upAddress = accounts[0];\n// 0x3E39275Ed3B370E074534edeE13a166512AD32aB\n")))),(0,r.kt)("h2",{id:"2-preparar-el-mensaje"},"2. Preparar el mensaje"),(0,r.kt)("p",null,"Para activar la pantalla de inicio de sesi\xf3n con Ethereum (SIWE), deber\xe1s preparar un mensaje con un formato espec\xedfico, como puedes ver en la ",(0,r.kt)("a",{parentName:"p",href:"https://eips.ethereum.org/EIPS/eip-4361"},"p\xe1gina est\xe1ndar")," o a continuaci\xf3n."),(0,r.kt)("details",null,(0,r.kt)("summary",null,"Plantilla SIWE"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"${domain} quiere que inicies sesi\xf3n con tu cuenta de Ethereum:\n${address}\n\n${statement}\n\nURI: ${uri}\nVersion: ${version}\nChain ID: ${chain-id}\nNonce: ${nonce}\nIssued At: ${issued-at}\nExpiration Time: ${expiration-time}\nNot Before: ${not-before}\nRequest ID: ${request-id}\nResources:\n- ${resources[0]}\n- ${resources[1]}\n  ...\n- ${resources[n]}\n"))),(0,r.kt)("p",null,"En JavaScript, puedes utilizar la librer\xeda ",(0,r.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/siwe"},(0,r.kt)("inlineCode",{parentName:"a"},"siwe")),"."),(0,r.kt)(s.Z,{mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"siwe",label:"Con la librer\xeda siwe",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"import { SiweMessage } from 'siwe';\n\n// ...\n\nconst message = new SiweMessage({\n  domain: window.location.host,\n  address: upAddress,\n  statement: 'Al iniciar sesi\xf3n, est\xe1 aceptando los t\xe9rminos y condiciones',\n  uri: window.location.origin,\n  version: '1',\n  chainId: '2828', // Para LUKSO L16\n  resources: ['https://terms.website.com'],\n});\n\nconst siweMessage = message.prepareMessage();\n"))),(0,r.kt)(i.Z,{value:"plain",label:"Sin librer\xeda siwe",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"// ...\n\nconst domain = window.location.host;\nconst origin = window.location.origin;\nconst LUKSO_L16_CHAIN_ID = '2828';\nconst nonce = 'm97bdsjo'; // un token aleatorio de al menos 8 caracteres alfanum\xe9ricos\nconst date = new Date();\nconst issuedAt = date.toISOString();\n\nconst siweMessage = `${domain} quiere que inicies sesi\xf3n con tu cuenta de Ethereum:\n\n${upAddress}\n\nAl iniciar sesi\xf3n, est\xe1 aceptando los t\xe9rminos y condiciones.\n\nURI: ${origin}\nVersi\xf3n: 1\nChain ID: ${LUKSO_L16_CHAIN_ID}\nNonce: ${nonce}\nEmitido en: ${issuedAt}\nRecursos:\n- https://terms.website.com`;\n")))),(0,r.kt)("h2",{id:"3-firmar-el-mensaje"},"3. Firmar el mensaje"),(0,r.kt)("p",null,"Una vez que dispongas de la direcci\xf3n del perfil universal, podr\xe1s solicitar una firma. La extensi\xf3n del navegador firmar\xe1 el mensaje con la clave de controlador utilizada por la extensi\xf3n (un contrato inteligente no puede firmar)."),(0,r.kt)(s.Z,{groupId:"provider",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"ethers",label:"Ethers.js",mdxType:"TabItem"},(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"Cuando se llama a Ethers.js ",(0,r.kt)("a",{parentName:"p",href:"https://docs.ethers.io/v5/api/signer/#Signer-signMessage"},(0,r.kt)("inlineCode",{parentName:"a"},"signer.signMessage( message )")),", utiliza la llamada RPC ",(0,r.kt)("inlineCode",{parentName:"p"},"personal_sign")," bajo el cap\xf3. Sin embargo, nuestra extensi\xf3n s\xf3lo soporta la \xfaltima versi\xf3n de ",(0,r.kt)("a",{parentName:"p",href:"https://ethereum.org/en/developers/docs/apis/json-rpc/#eth_sign"},(0,r.kt)("inlineCode",{parentName:"a"},"eth_sign")),". Por lo tanto, es necesario utilizar ",(0,r.kt)("inlineCode",{parentName:"p"},'provider.send("eth_sign", [upAddress, message])')," como sustituto.."),(0,r.kt)("p",{parentName:"admonition"},"Puedes obtener m\xe1s informaci\xf3n ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/MetaMask/metamask-extension/issues/15857"},"aqu\xed")," y ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/ethers-io/ethers.js/issues/1544"},"aqu\xed"),".")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const signature = await etherProvider.send('eth_sign', [upAddress, siweMessage]);\n// 0x38c53...\n"))),(0,r.kt)(i.Z,{value:"web3",label:"web3.js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const signature = await web3.eth.sign(siweMessage, upAddress);\n// 0x38c53...\n")))),(0,r.kt)("p",null,"\ud83c\udf89 Has recibido el mensaje firmado. Ahora, debes validarlo."),(0,r.kt)("h2",{id:"4-validar-la-firma"},"4. Validar la firma"),(0,r.kt)("p",null,"La aplicaci\xf3n ha recibido un mensaje firmado por la direcci\xf3n del controlador del perfil universal. Para finalizar el inicio de sesi\xf3n, es necesario verificar si el mensaje fue firmado por una direcci\xf3n que cuenta con la autorizaci\xf3n ",(0,r.kt)("inlineCode",{parentName:"p"},"SIGN")," para este UP."),(0,r.kt)("p",null,"Para ello, puedes utilizar la funci\xf3n ",(0,r.kt)("a",{parentName:"p",href:"../../standards/smart-contracts/lsp0-erc725-account#isvalidsignature"},(0,r.kt)("inlineCode",{parentName:"a"},"isValidSignature(...)"))," para comprobar si la firma ha sido suscrita (",(0,r.kt)("a",{parentName:"p",href:"https://eips.ethereum.org/EIPS/eip-1271"},"EIP-1271"),") por un EOA que tenga el permiso ",(0,r.kt)("a",{parentName:"p",href:"../../standards/universal-profile/lsp6-key-manager#permissions"},(0,r.kt)("inlineCode",{parentName:"a"},"SIGN"))," sobre el perfil universal."),(0,r.kt)(s.Z,{groupId:"provider",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"ethers",label:"Ethers.js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"import UniversalProfileContract from '@lukso/lsp-smart-contracts/artifacts/UniversalProfile.json';\n\n// ...\n\nconst myUniversalProfileContract = new ethers.Contract(upAddress, UniversalProfileContract.abi, signer);\n\nconst hashedMessage = ethers.utils.hashMessage(siweMessage);\n\nconst isValidSignature = await myUniversalProfileContract.isValidSignature(hashedMessage, signature);\n\nconst MAGIC_VALUE = '0x1626ba7e'; // https://eips.ethereum.org/EIPS/eip-1271\n\nif (isValidSignature === MAGIC_VALUE) {\n  console.log('\ud83c\udf89 \xa1Registro exitoso!');\n} else {\n  // La EOA que firm\xf3 el mensaje no cuenta con autorizaci\xf3n SIGN sobre este UP.\n  console.log('\ud83d\ude2d Fall\xf3 el inicio de sesi\xf3n');\n}\n"))),(0,r.kt)(i.Z,{value:"web3",label:"web3.js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"import UniversalProfileContract from '@lukso/lsp-smart-contracts/artifacts/UniversalProfile.json';\n\n// ...\n\nconst myUniversalProfileContract = new web3.eth.Contract(UniversalProfileContract.abi, upAddress);\n\nconst hashedMessage = web3.eth.accounts.hashMessage(siweMessage);\n\nconst MAGIC_VALUE = '0x1626ba7e'; // https://eips.ethereum.org/EIPS/eip-1271\n\n// si la firma es v\xe1lida deber\xeda devolver el valor m\xe1gico 0x1626ba7e\nconst isValidSignature = await myUniversalProfileContract.methods.isValidSignature(hashedMessage, signature).call();\n\nif (isValidSignature === MAGIC_VALUE) {\n  console.log('\ud83c\udf89 \xa1Registro exitoso!');\n} else {\n  // La EOA que firm\xf3 el mensaje no cuenta con autorizaci\xf3n SIGN sobre este UP.\n  console.log('\ud83d\ude2d Fall\xf3 el inico de sesi\xf3n');\n}\n")))),(0,r.kt)("p",null,"Si ",(0,r.kt)("inlineCode",{parentName:"p"},"isValidSignature")," devuelve el valor m\xe1gico: ",(0,r.kt)("inlineCode",{parentName:"p"},"0x1626ba7e"),", entonces, el mensaje fue firmado por un EOA que cuenta con autorizaci\xf3n ",(0,r.kt)("inlineCode",{parentName:"p"},"SIGN")," para este Perfil Universal."))}m.isMDXComponent=!0}}]);